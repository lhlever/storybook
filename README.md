# ğŸ“š StoryBook - åˆ›ä½œå‹ Agent ç³»ç»Ÿ

åŸºäº **LangGraph** + **Memory ç³»ç»Ÿ** çš„æ™ºèƒ½åˆ›ä½œåŠ©æ‰‹ï¼Œç”¨äºè‡ªåŠ¨åŒ–ç”Ÿæˆæ•…äº‹å¤§çº²ã€è§’è‰²è®¾è®¡ã€åˆ†é•œè„šæœ¬å’Œé•œå¤´è®¾è®¡ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ”„ LangGraph å·¥ä½œæµ
- **çŠ¶æ€å›¾ç®¡ç†**: ä½¿ç”¨ LangGraph æ„å»ºå¯æ‰©å±•çš„åˆ›ä½œæµç¨‹
- **èŠ‚ç‚¹åŒ–è®¾è®¡**: æ¯ä¸ªåˆ›ä½œæ­¥éª¤ç‹¬ç«‹ä¸ºèŠ‚ç‚¹ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
- **æµç¨‹å¯è§†åŒ–**: æ¸…æ™°çš„å·¥ä½œæµç¨‹ï¼Œä»å¤§çº²åˆ°é•œå¤´é€æ­¥æ¨è¿›

### ğŸ§  å››ç§ Memory ç³»ç»Ÿ
1. **Working Memory** - å·¥ä½œè®°å¿†ï¼šå­˜å‚¨å½“å‰ä»»åŠ¡çš„ä¸´æ—¶ä¿¡æ¯
2. **Episodic Memory** - æƒ…èŠ‚è®°å¿†ï¼šè®°å½•æ‰€æœ‰äº‹ä»¶å’Œæ“ä½œå†å²
3. **Semantic Memory** - è¯­ä¹‰è®°å¿†ï¼šå­˜å‚¨æ•…äº‹çŸ¥è¯†ï¼ˆå¤§çº²ã€è§’è‰²ã€åˆ†é•œã€é•œå¤´ï¼‰
4. **Profile Memory** - é…ç½®è®°å¿†ï¼šä¿å­˜é¡¹ç›®é…ç½®å’Œç”¨æˆ·åå¥½

### ğŸ› ï¸ åˆ›ä½œå·¥å…·é“¾
- `generate_story_outline` - ç”Ÿæˆæ•…äº‹å¤§çº²
- `design_ip` - è®¾è®¡è§’è‰²å’Œä¸–ç•Œè§‚
- `generate_storyboard` - ç”Ÿæˆåˆ†é•œè„šæœ¬
- `generate_shots` - ç”Ÿæˆè¯¦ç»†é•œå¤´è®¾è®¡

### ğŸ’» å‹å¥½çš„ CLI ç•Œé¢
- äº¤äº’å¼èœå•æ“ä½œ
- é¡¹ç›®åˆ›å»ºå’ŒåŠ è½½
- Memory çŠ¶æ€æŸ¥çœ‹
- è‡ªåŠ¨æŒä¹…åŒ–ä¿å­˜

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
storybook/
â”œâ”€â”€ agent_core.py       # LangGraph Agent æ ¸å¿ƒï¼ˆçŠ¶æ€å›¾å®šä¹‰ï¼‰
â”œâ”€â”€ memory.py           # Memory ç³»ç»Ÿå®ç°ï¼ˆ4ç§è®°å¿†ç±»å‹ï¼‰
â”œâ”€â”€ tools.py            # åˆ›ä½œå·¥å…·å‡½æ•°ï¼ˆæ¨¡æ‹Ÿ Claude APIï¼‰
â”œâ”€â”€ cli.py              # CLI äº¤äº’ç•Œé¢
â”œâ”€â”€ main.py             # ä¸»å…¥å£æ–‡ä»¶
â”œâ”€â”€ requirements.txt    # Python ä¾èµ–
â”œâ”€â”€ README.md           # é¡¹ç›®è¯´æ˜
â””â”€â”€ memory_storage/     # Memory æŒä¹…åŒ–å­˜å‚¨ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
cd storybook
pip install -r requirements.txt
```

### 2. è¿è¡Œæ¼”ç¤ºæ¨¡å¼

```bash
python main.py --demo
```

æ¼”ç¤ºæ¨¡å¼ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªç¤ºä¾‹é¡¹ç›® "æ—¶å…‰æ—…è¡Œè€…"ï¼Œå±•ç¤ºå®Œæ•´çš„åˆ›ä½œæµç¨‹ã€‚

### 3. äº¤äº’å¼ CLI æ¨¡å¼

```bash
python main.py
```

è¿›å…¥äº¤äº’å¼ç•Œé¢ï¼Œå¯ä»¥ï¼š
- åˆ›å»ºæ–°é¡¹ç›®
- åŠ è½½å·²æœ‰é¡¹ç›®
- æŸ¥çœ‹ Memory æ‘˜è¦
- æŸ¥çœ‹å·¥ä½œæµç¨‹

## ğŸ“– ä½¿ç”¨ç¤ºä¾‹

### åˆ›å»ºæ–°é¡¹ç›®

1. å¯åŠ¨ CLI: `python main.py`
2. é€‰æ‹© "1. åˆ›å»ºæ–°é¡¹ç›®"
3. è¾“å…¥é¡¹ç›®åç§°: `æˆ‘çš„ç§‘å¹»æ•…äº‹`
4. è¾“å…¥æ•…äº‹åˆ›æ„: `ä¸€ä¸ªå…³äºAIè§‰é†’çš„æ•…äº‹`
5. è®¾ç½®å¯é€‰å‚æ•°ï¼ˆæˆ–ä½¿ç”¨é»˜è®¤å€¼ï¼‰
6. ç¡®è®¤å¼€å§‹åˆ›ä½œ

### å·¥ä½œæµç¨‹è‡ªåŠ¨æ‰§è¡Œ

Agent å°†ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹èŠ‚ç‚¹ï¼š

```
åˆå§‹åŒ– â†’ ç”Ÿæˆæ•…äº‹å¤§çº² â†’ è®¾è®¡è§’è‰²å’Œä¸–ç•Œè§‚ â†’ åˆ›å»ºåˆ†é•œè„šæœ¬ â†’ ç”Ÿæˆé•œå¤´è®¾è®¡ â†’ å®Œæˆ
```

æ¯ä¸ªæ­¥éª¤éƒ½ä¼šï¼š
- âœ… è°ƒç”¨ç›¸åº”çš„å·¥å…·å‡½æ•°
- ğŸ’¾ æ›´æ–° Semantic Memory
- ğŸ“ è®°å½•åˆ° Episodic Memory
- ğŸ–¨ï¸ å®æ—¶æ˜¾ç¤ºè¿›åº¦

### æŸ¥çœ‹åˆ›ä½œæˆæœ

å®Œæˆåå¯ä»¥çœ‹åˆ°ï¼š
- ğŸ“– æ•…äº‹å¤§çº²ï¼ˆæ ‡é¢˜ã€ç±»å‹ã€å¹•æ•°ï¼‰
- ğŸ­ è§’è‰²è®¾è®¡ï¼ˆä¸»è§’ã€é…è§’ã€ä¸–ç•Œè§‚ï¼‰
- ğŸ¬ åˆ†é•œè„šæœ¬ï¼ˆåœºæ™¯ã€åˆ†é•œã€æ—¶é•¿ï¼‰
- ğŸ“¹ é•œå¤´è®¾è®¡ï¼ˆæ„å›¾ã€è¿é•œã€å…‰çº¿ï¼‰

æ‰€æœ‰å†…å®¹è‡ªåŠ¨ä¿å­˜åˆ° `memory_storage/` ç›®å½•ã€‚

## ğŸ§ª ç¤ºä¾‹è¾“å‡º

è¿è¡Œ `python main.py --demo` åçš„è¾“å‡ºç¤ºä¾‹ï¼š

```
==================================================
ğŸš€ åˆå§‹åŒ–åˆ›ä½œæµç¨‹
==================================================

ğŸ“ Step 1: ç”Ÿæˆæ•…äº‹å¤§çº²
--------------------------------------------------
[æ¨¡æ‹Ÿ Claude è°ƒç”¨] ç”Ÿæˆæ•…äº‹å¤§çº²...
âœ“ æ•…äº‹æ ‡é¢˜: æ—¶å…‰æ—…è¡Œè€…
âœ“ æ•…äº‹ç±»å‹: ç§‘å¹»/å‰§æƒ…

ğŸ­ Step 2: è®¾è®¡è§’è‰²å’Œä¸–ç•Œè§‚
--------------------------------------------------
[æ¨¡æ‹Ÿ Claude è°ƒç”¨] è®¾è®¡è§’è‰²å’Œä¸–ç•Œè§‚...
âœ“ è§’è‰²æ•°é‡: 2
âœ“ ä¸–ç•Œè§‚: ç°ä»£ä¸1920å¹´ä»£äº¤é”™

ğŸ¬ Step 3: ç”Ÿæˆåˆ†é•œè„šæœ¬
--------------------------------------------------
[æ¨¡æ‹Ÿ Claude è°ƒç”¨] ç”Ÿæˆåˆ†é•œè„šæœ¬...
âœ“ åœºæ™¯: å‘ç°æ—¥è®°
âœ“ åˆ†é•œæ•°é‡: 3
âœ“ æ€»æ—¶é•¿: 16ç§’

ğŸ“¹ Step 4: ç”Ÿæˆé•œå¤´è¯¦ç»†è®¾è®¡
--------------------------------------------------
[æ¨¡æ‹Ÿ Claude è°ƒç”¨] ç”Ÿæˆé•œå¤´è¯¦ç»†è®¾è®¡...
âœ“ é•œå¤´ S1-1: ä¸­æ™¯
âœ“ é•œå¤´ S1-2: è¿‘æ™¯åˆ‡ç‰¹å†™
âœ“ é•œå¤´ S1-3: é¢éƒ¨ç‰¹å†™

âœ… Step 5: å®Œæˆåˆ›ä½œæµç¨‹
--------------------------------------------------
âœ“ Memory å·²ä¿å­˜åˆ°: memory_storage/æ—¶å…‰æ—…è¡Œè€…_æ¼”ç¤º.json
âœ“ é¡¹ç›®å·²ä¿å­˜
âœ“ å®Œæˆæ­¥éª¤: 6
```

## ğŸ”§ æ ¸å¿ƒæ¨¡å—è¯´æ˜

### agent_core.py - LangGraph Agent

```python
# èŠ‚ç‚¹åˆ—è¡¨
- init: åˆå§‹åŒ–å·¥ä½œç¯å¢ƒ
- generate_outline: ç”Ÿæˆæ•…äº‹å¤§çº²
- design_characters: è®¾è®¡è§’è‰²å’Œä¸–ç•Œè§‚
- create_storyboard: åˆ›å»ºåˆ†é•œè„šæœ¬
- create_shots: ç”Ÿæˆé•œå¤´è®¾è®¡
- finalize: å®Œæˆå¹¶ä¿å­˜
```

èŠ‚ç‚¹å¯æ‰©å±•ï¼Œåªéœ€ï¼š
1. åœ¨ `_build_graph()` ä¸­æ·»åŠ æ–°èŠ‚ç‚¹
2. å®ç°å¯¹åº”çš„èŠ‚ç‚¹å‡½æ•°
3. é…ç½®èŠ‚ç‚¹é—´çš„è¿æ¥å…³ç³»

### memory.py - Memory ç³»ç»Ÿ

```python
# ä½¿ç”¨ç¤ºä¾‹
memory = MemorySystem("æˆ‘çš„é¡¹ç›®")

# Working Memory
memory.working.set("current_task", "ç”Ÿæˆå¤§çº²")

# Episodic Memory
memory.episodic.add_episode("outline_created", outline_data)

# Semantic Memory
memory.semantic.update_knowledge("story_outline", outline)

# Profile Memory
memory.profile.update_settings({"story_style": "ç§‘å¹»"})

# ä¿å­˜åˆ°ç£ç›˜
memory.save_to_disk()

# ä»ç£ç›˜åŠ è½½
memory.load_from_disk("æˆ‘çš„é¡¹ç›®.json")
```

### tools.py - å·¥å…·å‡½æ•°

æ‰€æœ‰å·¥å…·å‡½æ•°éƒ½åŒ…å«æ¨¡æ‹Ÿçš„ Claude API è°ƒç”¨ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¯ä»¥æ›¿æ¢ä¸ºçœŸå®çš„ APIï¼š

```python
# æ›¿æ¢ simulate_claude_call å‡½æ•°
def simulate_claude_call(prompt: str, task_type: str) -> str:
    # çœŸå®å®ç°
    from anthropic import Anthropic
    client = Anthropic(api_key="your-api-key")

    message = client.messages.create(
        model="claude-opus-4-5-20251101",
        max_tokens=2048,
        messages=[{"role": "user", "content": prompt}]
    )

    return message.content[0].text
```

## ğŸ¯ æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°çš„åˆ›ä½œèŠ‚ç‚¹

1. åœ¨ `tools.py` ä¸­æ·»åŠ æ–°å·¥å…·å‡½æ•°
2. åœ¨ `agent_core.py` ä¸­æ·»åŠ æ–°èŠ‚ç‚¹æ–¹æ³•
3. åœ¨ `_build_graph()` ä¸­æ³¨å†ŒèŠ‚ç‚¹å’Œè¿æ¥

ç¤ºä¾‹ï¼šæ·»åŠ  "ç”Ÿæˆé…ä¹" èŠ‚ç‚¹

```python
# tools.py
def generate_music(storyboard, memory_context):
    # å®ç°é…ä¹ç”Ÿæˆé€»è¾‘
    pass

# agent_core.py
def create_music_node(self, state):
    music = generate_music(state["storyboards"][0], {})
    state["music"] = music
    return state

# åœ¨ _build_graph() ä¸­
workflow.add_node("create_music", self.create_music_node)
workflow.add_edge("create_shots", "create_music")
workflow.add_edge("create_music", "finalize")
```

### æ·»åŠ æ–°çš„ Memory ç±»å‹

åœ¨ `memory.py` ä¸­åˆ›å»ºæ–°çš„ Memory ç±»ï¼š

```python
class LongTermMemory:
    def __init__(self):
        self.archive = []

    def store(self, data):
        self.archive.append(data)
```

## ğŸ” ç¯å¢ƒé…ç½®

å¦‚æœéœ€è¦ä½¿ç”¨çœŸå®çš„ Claude APIï¼Œåˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
# .env
ANTHROPIC_API_KEY=your-api-key-here
```

ç„¶ååœ¨ä»£ç ä¸­åŠ è½½ï¼š

```python
from dotenv import load_dotenv
load_dotenv()
```

## ğŸ“Š Memory å­˜å‚¨æ ¼å¼

Memory ä»¥ JSON æ ¼å¼ä¿å­˜åœ¨ `memory_storage/` ç›®å½•ï¼š

```json
{
  "working": {
    "current_project": "æ—¶å…‰æ—…è¡Œè€…"
  },
  "episodic": {
    "episodes": [
      {
        "timestamp": "2024-01-20T10:30:00",
        "event_type": "outline_created",
        "content": {...}
      }
    ]
  },
  "semantic": {
    "story_outline": {...},
    "characters": [...],
    "storyboards": [...],
    "shots": [...]
  },
  "profile": {
    "project_name": "æ—¶å…‰æ—…è¡Œè€…",
    "settings": {...}
  }
}
```

## ğŸ›£ï¸ è·¯çº¿å›¾

- [ ] é›†æˆçœŸå®çš„ Claude API
- [ ] æ·»åŠ æ›´å¤šåˆ›ä½œèŠ‚ç‚¹ï¼ˆé…ä¹ã€ç‰¹æ•ˆã€åæœŸï¼‰
- [ ] æ”¯æŒå¤šåœºæ™¯å¹¶è¡Œåˆ›ä½œ
- [ ] Web ç•Œé¢
- [ ] åä½œæ¨¡å¼ï¼ˆå¤šç”¨æˆ·ï¼‰
- [ ] å¯¼å‡ºä¸ºè§†é¢‘è„šæœ¬æ ¼å¼
- [ ] å¯è§†åŒ– LangGraph æµç¨‹å›¾

## ğŸ“ è®¸å¯è¯

MIT License

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ Issue è”ç³»ã€‚

---

**äº«å—åˆ›ä½œçš„ä¹è¶£ï¼** ğŸ¨âœ¨
